<header class="upper_block">
   <%= image_tag("Immagine2.png", size:"384.6153846x108.4615338", class: "logo")%> 
</header>

<% if user_signed_in? or administrator_signed_in? %>
<div class="logout_dashboard">
    <%if user_signed_in?%>
        <text>  WELCOME BACK <%=current_user["username"]%> !</text>
        <br></br>
        <%= button_to "LOGOUT", destroy_user_session_path, :method => :delete %>
    <%end%>
    <%if administrator_signed_in?%>
        <text> WELCOME BACK <%current_administrator["username"]%>! </text>
        <br></br>
        <%= button_to "LOGOUT", destroy_administrator_session_path, :method => :delete if administrator_signed_in? %>
    <%end%>
</div>
<%end%>

<div class="left_block">
    <div class= "scrollable_box">
        <div class="scrollable">
            <text>FAVORITE PUBLICATIONS:</text>
            <ul>
                <% @favorite_publications.each do |favorite_publication| %>
                    <%author_name= Author.where(author_id:favorite_publication.author_id)[0].name %>
                    <li>Author: <%=author_name%>, Title:<%=favorite_publication.title%>, Date: <%=favorite_publication.pub_year%></li>
                <%end%>
            </ul>
        </div>
    </div>
    
    <div class= "scrollable_box">
        <div class="scrollable">
            <text>FAVORITE AUTHORS</text>
            <ul>
                <% @favorite_authors.each do |favorite_author| %>
                    <%author= Author.where(author_id:favorite_author.author_id)[0] %>
                    <li>Author: <%=author.name%></li> <!-- Affiliations:<%=author.affiliations%>, Interests: <%=author.interests%> -->
                <%end%>
            </ul>
        </div>
    </div>

    <div class= "scrollable_box">
        <div class="scrollable">
            <text style="">LATEST PUBLICATIONS FROM YOUR FAVOURITE AUTHORS</text>
            <%  @latest_pub_fav_auth.each do |latest_pub| %>
             <% written= Written.where(:publication_id => latest_pub.publication_id)[0]%>
             <% author_name= Author.find(written.author_id).name%>
             <li>Author: <%=author_name%>, Title:<%=latest_pub.title%>, Date: <%=latest_pub.pub_year%></li>
            <%end%>
        </div>
    </div>
</div>

<div class="right_block">
    <div class= "upper_right_block">
        <button onclick= "searchByAuth()" id= "ByAuth" style="background-color:#79d1c3;" > SEARCH BY AUTH </button>
        <button onclick= "searchByPub()" id= "ByPub" style="background-color:#c9fdd7;"> SEARCH BY PUB</button>
        <button onclick="location.href='https://127.0.0.1:3000/authors'"> AUTHORS</button> 
        <button onclick="location.href='https://127.0.0.1:3000/publications'"> PUBLICATIONS</button>
        <% if !user_signed_in? && !administrator_signed_in? %>
            <button onclick="location.href='https://127.0.0.1:3000/users/sign_up'"> LOGIN/REGISTER</button>
            <button onclick="location.href='https://127.0.0.1:3000/administrators/sign_up'"> RESERVED AREA</button>
        <% elsif user_signed_in?%>
            <% user_show= "https://127.0.0.1:3000/users/#{current_user["user_id"]}"%>
            <button onclick= "location.href='<%=user_show%>'"> MY DATA</button>
        <%end%>
        <p id="p1"> </p>
    </div>

    <div class= "bottom_right_block">
        <div class="bottom_right_block_left">
                <h2>PREMIUM CHARTS</h2>
                <fieldset class= "chart_choise">
                    <legend>CHOOSE A CHART:</legend>
                    <br>
                    <label>ON AUTHORS:</label><br>
                    <br>
                    <input type="radio" id="most_cited_authors_trend" name="choise" onclick="most_cited_authors_graph()" checked > <label for="most_cited_authors_trend"> Most cited authors</label><br> <br>
                    <input type="radio" id="auth_ratings" name="choise" onclick="auth_ratings_graph()" > <label for="auth_ratings"> Hightest rate authors</label><br><br>
                    <input type="radio" id="most_commented_authors" name="choise" onclick="most_commented_authors_graph()"> <label for="most_commented_authors"> Most commented authors</label><br> <br>
                    <label>ON PUBLICATIONS:</label><br>
                    <br>
                    <input type="radio" id="pub_per_year" name="choise" onclick="pub_per_year_graph()"> <label for="pub_per_year"> Total publications per year</label><br> <br>
                    <input type="radio" id="pub_ratings" name="choise" onclick="pub_ratings_graph()"> <label for="pub_ratings"> Hightest rate publications</label><br><br>
                    <input type="radio" id="most_cited_publications" name="choise" onclick="most_cited_publication_graph()"> <label for="most_cited_authors"> Most cited publication</label><br><br>
                </fieldset>
    
        </div>
        <div class="bottom_right_block_right">
        <div class="filters", style="padding-left:7%;">
            <label for="filters">Chart filters:</label>
            <select name="filters" id="filters">
                <option value="filtro1">Filtro1</option>
                <option value="filtro2">Filtro2</option>
                <option value="filtro3">Filtro3</option>
                <option value="filtro4">Filtro4</option>  
            </select>
        </div>
        <br></br>
        <div class="graph" id="chart1" style="visibility:visible;"}>
                <%= line_chart @most_cited_authors.sort_by{|x| -x.graph.length}.map { |most_cited|
                    {
                        name: Author.find(most_cited.author_id).name,
                        data: Graphs.new.hash_graph(most_cited.graph)
                    }
                }, discrete: true, 
                   xtitle: "years", 
                   ytitle: "citations",
                   colors: ["#49beb7", "#6892d5", "#7c4789", "#9973e2", "#7b99fa"], 
                   title:"MOST CITED AUTHORS"%>
        </div>
        <div class="graph" id="chart2" style="visibility:hidden;">
            <%= column_chart Graphs.new.authors_avg_ratings(Author.all, 10), 
            colors: ["#97f6b0", "#80e7ad", "#69d8ab", "#55c8a7", "#41b9a3", "#2fa99d", "#1f9a96", "#0f8a8f","#037b86", "#006c7b" ], 
            title:"HIGHEST RATE AUTHORS"%>
        </div>
        <div class="graph" id="chart3" style="visibility:hidden;">
            To be done...
        </div>
        <div class="graph" id="chart4" style="visibility:hidden;">
            <%= column_chart Publication.where(pub_year: (Date.today.year - 10 ..)).group(:pub_year).order(:pub_year).count, 
            colors: ["#97f6b0", "#80e7ad", "#69d8ab", "#55c8a7", "#41b9a3", "#2fa99d", "#1f9a96", "#0f8a8f","#037b86", "#006c7b" ], 
            discrete: true, 
            title:"LAST 10 YEARS PUBLICATIONS"%>
        </div>
        <div class="graph" id="chart5" style="visibility:hidden;">
            To be done...
        </div>
        <div class="graph" id="chart6" style="visibility:hidden;">
            <% data= []%>
            <% for year in (Date.today.year - 9 .. Date.today.year )%>
            <% most_cited=Publication.distinct.order(cited_by: :desc).where(pub_year:year).first()%>
            <% if (most_cited != nil)%>
                <% data << [ year.to_s + ": "+  most_cited.title, most_cited.cited_by]%>
            <%end%>
            <%end%>
            <%= column_chart data,
            colors: ["#97f6b0", "#80e7ad", "#69d8ab", "#55c8a7", "#41b9a3", "#2fa99d", "#1f9a96", "#0f8a8f","#037b86", "#006c7b" ],
            discrete: true, 
            title:"MOST CITED PUBLICATIONS"%>
        </div>
        </div>
    </div>
</div>

<div class="footer" float:left>
    <a href="/contacts">CONTACT US</a>
    <a href="/info">INFO</a>
    <a href="/use_and_conditions">USE TERMS AND CONDITIONS</a>
    <a href="/privacy">PRIVACY</a>
    <a href="/cookies">COOKIES</a>
</div>

<%= javascript_include_tag "home"%>
<%= javascript_include_tag "Chart" %>
<%= javascript_include_tag "chartkick" %>
<%= javascript_include_tag "chartjs-adapter-date-fns.bundle"%>
<%= javascript_include_tag "application" %>
<script> searchByAuth();</script>

