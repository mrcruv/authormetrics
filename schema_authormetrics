CREATE TABLE utente(
	id SERIAL PRIMARY KEY NOT NULL,
	username varchar(25) NOT NULL,
	psw varchar(30) NOT NULL,
	email varchar(45) NOT NULL,
	nome varchar(20) NOT NULL,
	cognome varchar(20) NOT NULL,
	data_nascita date NOT NULL,
	data_iscrizione TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
	UNIQUE(username,email)
);

CREATE TABLE Author (
	_id varchar(25) NOT NULL,
	nome_cognome varchar(50) NOT NULL,
	interest varchar(25)[],
	affiliazioni text,
	PRIMARY KEY(_id)
	
);

CREATE TABLE Articolo(
	_id varchar(25) NOT NULL,
	titolo text NOT NULL,
	pubblication text NOT NULL,
	cited_by integer NOT NULL check(cited_by>=0),
	anno_pubblicazione integer NOT NULL,
	PRIMARY KEY(_id)
);

CREATE TABLE Scritto(
	author_id varchar(25) NOT NULL,
	articolo_id varchar(25) NOT NULL,
	PRIMARY KEY(author_id,articolo_id),
	FOREIGN KEY (articolo_id) REFERENCES Articolo(_id),
	FOREIGN KEY (author_id) REFERENCES Author (_id)
);

CREATE TABLE Autore_preferito(
	author_id varchar(25) NOT NULL,
	utente_id SERIAL NOT NULL,
	PRIMARY KEY(utente_id,author_id),
	FOREIGN KEY (utente_id) REFERENCES utente(id),
	FOREIGN KEY (author_id) REFERENCES Author (_id)
);

CREATE TABLE Rating_autore(
	author_id varchar(25),
	utente_id SERIAL NOT NULL,
	rating integer NOT NULL check(rating>0 and rating <11),
	data_valutazione date NOT NULL,
	PRIMARY KEY(utente_id,author_id),
	FOREIGN KEY (utente_id) REFERENCES utente(id),
	FOREIGN KEY (author_id) REFERENCES Author (_id)
);

CREATE TABLE Recensione_autore(
	author_id varchar(25),
	utente_id SERIAL NOT NULL,
	recensione text NOT NULL,
	data_recensione date NOT NULL,
	PRIMARY KEY(author_id,utente_id),
	FOREIGN KEY (utente_id) REFERENCES utente(id),
	FOREIGN KEY (author_id) REFERENCES Author (_id)
);

CREATE TABLE articolo_preferito(
	articolo_id varchar(25) NOT NULL REFERENCES articolo(_id),
	utente_id SERIAL NOT NULL,
	FOREIGN KEY(utente_id) REFERENCES utente(id),
	PRIMARY KEY(articolo_id,utente_id)
);

CREATE TABLE rating_articolo(
	articolo_id varchar(25) NOT NULL REFERENCES articolo(_id),
	utente_id SERIAL NOT NULL,
	rating integer NOT NULL check(rating>0 and rating <11),
	data_valutazione date NOT NULL,
	FOREIGN KEY(utente_id) REFERENCES utente(id),
	PRIMARY KEY(articolo_id,utente_id)
);

CREATE TABLE Commento(
	articolo_id varchar(25) NOT NULL REFERENCES articolo(_id),
	utente_id SERIAL NOT NULL,
	testo text NOT NULL,
	data_commento date DEFAULT CURRENT_DATE NOT NULL,
	ora time DEFAULT CURRENT_TIME  NOT NULL,
	FOREIGN KEY(utente_id) REFERENCES utente(id),
	PRIMARY KEY(articolo_id,utente_id,data_commento,ora)
);
